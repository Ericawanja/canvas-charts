<!DOCTYPE HTML>
<html>
<head>
    <title>Report</title>
    <style>
        table {
          font-family: arial, sans-serif;
          border-collapse: collapse;
          width: 100%;
        }
        
        td{
          border: 1px solid #dddddd;
          text-align: left;
          padding: 8px;
        }
        
        tr:nth-child(even) {
          background-color: #dddddd;
        }
        </style>
</head>
<body>
    <body>
        <table class='table1'>
            <tr id="header_row"><td>Duration</td></tr>
            <tr id="opening_balance_row"><td >Opening Balance</td></tr>
            <tr id="new_subscription_row"><td>New Subscription</td></tr>
            <tr id="lost_subscription"><td>Lost Subscription</td></tr>
            <tr id="expansion_subscription_row"><td>Subscription Expansion</td></tr>
            <tr id="contraction_subscription_row"><td>Subscription Contraction</td></tr>      
            <tr id="opening_count_row"><td>Opening Customers</td></tr>
            <tr id="new_count_row"><td>New Customers</td></tr>
            <tr id="lost_count_row"><td>Lost customers</td></tr>
            <tr id="expansion_count_row"><td>Customer upgrading packages</td></tr>
            <tr id="contraction_count_row"><td>Customer Downgrading packages</td></tr>          
         </table>
         <!--MAIN WRAPPER OF ALL GRAPHS-->
         <div class="wrapper">
            <!-- <div class="columnChartContainers">
                <div id="chartContainer1" style="height: 400px; width: 100%;"></div>
                <div id="chartContainer2" style="height: 400px; width: 100%;"></div>
                <div id="chartContainer3" style="height: 400px; width: 100%;"></div>
                <div id="chartContainer4" style="height: 400px; width: 100%;"></div>
                <div id="chartContainer5" style="height: 400px; width: 100%;"></div>
                <div id="chartContainer6" style="height: 400px; width: 100%;"></div>
                <div id="chartContainer7" style="height: 400px; width: 100%;"></div>
                <div id="chartContainer8" style="height: 400px; width: 100%;"></div>
                <div id="chartContainer9" style="height: 400px; width: 100%;"></div>
                <div id="chartContainer10" style="height: 400px; width: 100%;"></div>
               </div>
              <div class='verticalCharts'>
                  <div id="plan_purchases_container1" style="height: 400px; width: 100%;"></div>
                  <div id="plan_purchases_container2" style="height: 400px; width: 100%;"></div>
              </div>
              <div class="lineGraphContainer">
                <div id="lineGraph1" style="height: 300px; width: 100%;"></div>
              </div>-->
              <div class="pieCharts">
                <div id="chartContainer2" style="height: 370px; width: 100%;"></div>
                <div id="chartContainer" style="height: 370px; width: 100%;"></div>
                <div id="chartContainer3" style="height: 370px; width: 100%;"></div>
               <div id="chartContainer4" style="height: 370px; width: 100%;"></div>
              </div>
         </div>
      

<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
<script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
<script type="text/javascript">

window.onload = function () {  

    /*var dataPoints= [] 
            var mrrPoints=[
                ['2021-Jan', 469000.0, 53000.0, -91000.0, 0.0, -0.0, 147.0, 15.0, 30, 0, 0, 0.0, -0.0, 147.0, 15.0, -30, 0, 0, 114262.5428, 27113.0969, 3186.1804, 30299.2772], 
                ['2021-Feb', 521000.0, 53500.0, -80500.0, 0.0, -0.0, 160.0, 18.0, 26, 0, 0, 0.0, -0.0, 160.0, 18.0, -26, 0, 0, 110617.3831, 27268.0515, 2914.0153, 30182.0669], 
                ['2021-Mar', 553500.0, 61500.0, -72500.0, 0.0, -0.0, 172.0, 17.0, 24, 0, 0, 0.0, -0.0, 172.0, 17.0, -24, 0, 0, 131039.0456, 33601.4431, 3523.1395, 37124.5827], 
                ['2021-Apr', 626000.0, 40000.0, -65000.0, 0.0, -0.0, 191.0, 11.0, 21, 0, 0, 0.0, -0.0, 191.0, 11.0, -21, 0, 0, 124560.6914, 35126.6503, 3543.4061, 38670.0564], 
                ['2021-May', 624000.0, 58500.0, -99000.0, 0.0, -0.0, 190.0, 19.0, 32, 0, 0, 0.0, -0.0, 190.0, 19.0, -32, 0, 0, 137865.4894, 37739.3025, 3903.2389, 41642.5413], 
                ['2021-Jun', 581000.0, 3000.0, -42500.0, 0.0, -0.0, 181.0, 1.0, 13, 0, 0, 0.0, -0.0, 181.0, 1.0, -13, 0, 0, 155261.9561, 40116.2419, 3897.1746, 44013.4165], 
                ['2021-Jul', 650500.0, 28000.0, -67000.0, 0.0, -0.0, 201.0, 9.0, 21, 0, 0, 0.0, -0.0, 201.0, 9.0, -21, 0, 0, 158343.4128, 40318.1565, 3904.8868, 44223.0434]
        ]
        function plotData(x,y, container, labelY,title){
            
        $.each(mrrPoints, function(index, item){
            dataPoints.push({
                label:item[x],
                y:item[y]
            })
        })
        CanvasJS.addColorSet("greenShades",
                [  '#FF9900',]);
	var chart = new CanvasJS.Chart(container, {
        colorSet: "greenShades",
		title:{
			text: title,              
		},
        axisX: {
	          title: "Months",
        },
        axisY: {
	        title: labelY,
	         titleFontSize: 24
        },
		data: [              
		{
			
			type: "column",
			dataPoints: dataPoints
		}
		]
	});
	chart.render();
    dataPoints.length=0

}

    let table=$('.table')
    let tablePoints=mrrPoints.slice(0,6)
    $.each(mrrPoints, function(index, value){
        let tableData=[]
        let tableRow=[]
        //console.log(value)
        function table0_5(m,n){
        let subArr=value.slice(m,n)
        //console.log(subArr)
        for(let i=0; i<subArr.length;i++){
            tableData.push("<td>" + subArr[i] +"</td>")
            //console.log(tableData)
        }
       // console.log(tableData[0])
        $(document).ready(function(){
            console.log(tableData[0])
            $('#header_row').append(tableData[0])
            $("#opening_balance_row").append(tableData[1])
            $("#new_subscription_row").append(tableData[2])
            $("#lost_subscription").append(tableData[3])
            $("#expansion_subscription_row").append(tableData[4])
            $("#contraction_subscription_row").append(tableData[5])
            $('#opening_count_row').append(tableData[7])
            $("#new_count_row").append(tableData[8])
            $("#lost_count_row").append(tableData[9])
            $("#expansion_count_row").append(tableData[10])
            $("#contraction_count_row").append(tableData[11])
        }) 
    }
    
    table0_5(0,12)
      
    })
    
    plotData(0,1,"chartContainer1", "Growth Rate (in Ksh)", "MRR Growth")
    plotData(0,2, "chartContainer2", "Revenue Rate(in ksh)", "New subscription" )
    plotData(0,3,"chartContainer3", "Revenue Rate (in Ksh)", "Lost subscription")
   plotData(0,4, "chartContainer4", "Upgrade Rate(in ksh)" , "Subscription expansion" )
   plotData(0,5,"chartContainer5", "DownGrade Rate (in Ksh)", "Subscription Contraction")
   plotData(0,6, "chartContainer6", "Customers Rate(in ksh)", "Customers for Particular amount")
   plotData(0,7,"chartContainer7", "New customers", "New customers")
   plotData(0,8, "chartContainer8", "Lost Customers", "Lost Customers" )
   plotData(0,9,"chartContainer9", "Upgraded customers", "Upgraded customers")
   plotData(0,10, "chartContainer10", "DownGraded customers", "Downgraded customers" )
     

  var planAndPurchasesData= [
    {'username': 'lamuhouse', 'first_name': 'Lamu House', 'purchases': 7, 'plan_amount': 112000.0},
    {'username': 'ibnusinah', 'first_name': 'ibnu sina', 'purchases': 7, 'plan_amount': 45500.0}, 
    {'username': 'almaawiya', 'first_name': 'Al Maawiya', 'purchases': 6, 'plan_amount': 42000.0},
    {'username': 'shelaroyal', 'first_name': 'Alwiya', 'purchases': 7, 'plan_amount': 35000.0}, 
    {'username': 'maharus', 'first_name': 'Fahad', 'purchases': 7, 'plan_amount': 35000.0}, 
    {'username': 'morocco', 'first_name': 'Morocco', 'purchases': 7, 'plan_amount': 35000.0}, 
    {'username': 'habib', 'first_name': 'Abdalla', 'purchases': 7, 'plan_amount': 35000.0}, 
    {'username': 'savelamu', 'first_name': 'Alwiya', 'purchases': 7, 'plan_amount': 35000.0}, 
    {'username': 'kinoonihouse', 'first_name': 'Abdul', 'purchases': 7, 'plan_amount': 35000.0}, 
    {'username': 'stephanie', 'first_name': 'Stephanie', 'purchases': 6, 'plan_amount': 30000.0}, 
    {'username': 'brightgirls', 'first_name': 'Bright Girls', 'purchases': 6, 'plan_amount': 30000},
    {'username': 'fatumastower', 'first_name': 'Angelika', 'purchases': 3, 'plan_amount': 30000.0},
    {'username': 'majid', 'first_name': 'Majid', 'purchases': 7, 'plan_amount': 28000.0}, 
    {'username': 'alibahasan', 'first_name': 'Ali said', 'purchases': 9, 'plan_amount': 27000.0}, 
    {'username': 'badru', 'first_name': 'Badru', 'purchases': 9, 'plan_amount': 27000.0},
     {'username': 'charleskamadi', 'first_name': 'Charles', 'purchases': 5, 'plan_amount': 25000.0},
     {'username': 'kasbah', 'first_name': 'Kasbah', 'purchases': 3, 'plan_amount': 25000.0}, 
     {'username': 'mewadic', 'first_name': 'Mewa', 'purchases': 5, 'plan_amount': 25000.0}, 
     {'username': 'saada', 'first_name': 'Saada', 'purchases': 5, 'plan_amount': 25000.0}, 
     {'username': 'shellastopover', 'first_name': 'Hamid', 'purchases': 8, 'plan_amount': 24000.0}
    ]
    function plotPlan_Purchases(container, title, objProperty){
    let purchasesData=[]
    let planAmountData=[]
    $.each(planAndPurchasesData, function(index, item){
        purchasesData.push({
            y:item[objProperty],
            label:item['username']
        })
    })
    console.log(purchasesData)
    var chart = new CanvasJS.Chart(container,
    {
      title:{
        text: title
      },
      data: [
      {
        type: "bar",
        dataPoints: purchasesData
      },
      ]
    });

chart.render();
  }
  //function(htmlContainer, Title, PlanToPlot)NB; pass as a string, case sensitive
  plotPlan_Purchases("plan_purchases_container1", "Purchases", "purchases")
  plotPlan_Purchases("plan_purchases_container2", "Plan Amount", "plan_amount")

  //lineGraph
  
  let lineGraphData=[
    ['2021-Jan', 471500.0, 53000.0, -91000.0, 0.0, -0.0, 148.0, 15.0, -30, 0, 0, 114262.5428, 27113.0969, 3186.1804, 30299.2772], 
    ['2021-Feb', 521000.0, 53500.0, -80500.0, 0.0, -0.0, 160.0, 18.0, -26, 0, 0, 110617.3831, 27268.0515, 2914.0153, 30182.0669], 
    ['2021-Mar', 553500.0, 61500.0, -72500.0, 0.0, -0.0, 172.0, 17.0, -24, 0, 0, 131039.0456, 33601.4431, 3523.1395, 37124.5827], 
    ['2021-Apr', 626000.0, 40000.0, -65000.0, 0.0, -0.0, 191.0, 11.0, -21, 0, 0, 124560.6914, 35126.6503, 3543.4061, 38670.0564], 
    ['2021-May', 624000.0, 58500.0, -99000.0, 0.0, -0.0, 190.0, 19.0, -32, 0, 0, 137865.4894, 37739.3025, 3903.2389, 41642.5413], 
    ['2021-Jun', 584000.0, 3000.0, -36500.0, 0.0, -0.0, 182.0, 1.0, -11, 0, 0, 155257.8008, 40096.7565, 3896.0722, 43992.8287], 
    ['2021-Jul', 656500.0, 28000.0, -70000.0, 0.0, -0.0, 203.0, 9.0, -22, 0, 0, 158379.2783, 40328.1151, 3906.1855, 44234.3006]
]
function lineGraph(timeOnline, download, upload, consumption, container){
    let timeOnlineData=[]
    let downloadData=[]
    let uploadData=[]
    let consumptionData=[]
    $.each(lineGraphData, function(index, item){
        timeOnlineData.push(
            {
              label:item[0],
              y:item[timeOnline]
        })
        downloadData.push(
            {
                label:item[0],
                y:item[download]
            }
        )
        uploadData.push(
            {
                label:item[0],
                y:item[upload]
            }
        )
        consumptionData.push(
            {
               label:item[0],
               y:item[consumption]
           }
        )
    })
    console.log(timeOnlineData)
    console.log(uploadData)
    console.log(downloadData)
    console.log(consumptionData)

var chart = new CanvasJS.Chart(container, {
	animationEnabled: true,
	exportEnabled: true,
	title:{
		text: "Time online and data consumed"             
	}, 
	axisY:{
		title: "Data"
	},
	toolTip: {
		shared: true
	},
	legend:{
		cursor:"pointer",
		itemclick: toggleDataSeries
	},
	data: [{        
		type: "spline",  
		name: "Time online",        
		showInLegend: true,
		dataPoints: timeOnlineData
	}, 
	{        
		type: "spline",
		name: "Download",        
		showInLegend: true,
		dataPoints: downloadData
	},
	{        
		type: "spline",  
		name: "Upload",        
		showInLegend: true,
		dataPoints: uploadData
	},
	 
	{        
		type: "spline",  
		name: "Consumption Data",        
		showInLegend: true,
		dataPoints: consumptionData
	}]
});

chart.render();

function toggleDataSeries(e) {
	if(typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
		e.dataSeries.visible = false;
	}
	else {
		e.dataSeries.visible = true;            
	}
	chart.render();
}
}
lineGraph(11,12,13,14, "lineGraph1")*/ 

//PIECHART

var plans = [{'name': '4 Mbps for Sh 7000', 'plan_amount': 42000.0, 'plan_purchases': 6}, {'name': '2 Mbps Shella', 'plan_amount': 441000.0, 'plan_purchases': 147}, {'name': '1 Mbps for sh 2,000', 'plan_amount': 48000.0, 'plan_purchases': 24}, {'name': '3Mbps for sh 4,000', 'plan_amount': 52000.0, 'plan_purchases': 13}, {'name': '2 Mbps for sh 3,000', 'plan_amount': 87000.0, 'plan_purchases': 29}, {'name': '7 mbps for ksh 16,000', 'plan_amount': 112000.0, 'plan_purchases': 7}, {'name': '3 Mbps for sh 3,000', 'plan_amount': 2805000.0, 'plan_purchases': 935}, {'name': '1Mbps for sh 2,500', 'plan_amount': 135000.0, 'plan_purchases': 54}, {'name': '4 Mbps Shella', 'plan_amount': 36000.0, 'plan_purchases': 9}, {'name': '5 Mbps for sh 6,500', 'plan_amount': 45500.0, 'plan_purchases': 7}, {'name': '7 mbps shella', 'plan_amount': 50000.0, 'plan_purchases': 5}, {'name': '3 Mbps shella', 'plan_amount': 195000.0, 'plan_purchases': 39}, {'name': '3 Mbps for sh 5,000', 'plan_amount': 225000.0, 'plan_purchases': 45}, {'name': '5 Mbps Shella', 'plan_amount': 7000.0, 'plan_purchases': 1}]
var plan_plot_amount=[]
var plan_plot_count = []
$.each(plans,function(k,v){
   plan_plot_amount.push({y:v['plan_amount'],label:v['name']})
   plan_plot_count.push({y:v['plan_purchases'],label:v['name']})
   console.log(v['name'])
   console.log(v['plan_amount'])
   console.log(v['plan_purchases'])
})

var chart = new CanvasJS.Chart("chartContainer", {
	animationEnabled: true,
	title: {
		text: "Plan Amount Subscriptions"
	},
	data: [{
		type: "pie",
		startAngle: 240,
		yValueFormatString: "##0.00\"%\"",
		indexLabel: "{label} {y}",
		dataPoints: plan_plot_amount
	}]
});

var chart2 = new CanvasJS.Chart("chartContainer2", {
	animationEnabled: true,
	title: {
		text: "Purchases"
	},
	data: [{
		type: "pie",
		startAngle: 240,
		yValueFormatString: "##0.00\"%\"",
		indexLabel: "{label} {y}",
		dataPoints: plan_plot_count
	}]
});


var chart3 = new CanvasJS.Chart("chartContainer3", {
	animationEnabled: true,
	title:{
		text: "Olympic Medals of all Times (till 2016 Olympics)"
	},
	axisY: {
		title: "Medals",
		includeZero: true
	},
	legend: {
		cursor:"pointer",
		itemclick : toggleDataSeries
	},
	toolTip: {
		shared: true,
		content: toolTipFormatter
	},
	data: [{
		type: "bar",
		showInLegend: true,
		name: "Gold",
		color: "teal",
		dataPoints:plan_plot_amount
	}]
});


var chart4 = new CanvasJS.Chart("chartContainer4", {
	animationEnabled: true,
	title:{
		text: "Olympic Medals of all Times (till 2016 Olympics)"
	},
	axisY: {
		title: "Medals",
		includeZero: true
	},
	legend: {
		cursor:"pointer",
		itemclick : toggleDataSeries
	},
	toolTip: {
		shared: true,
		content: toolTipFormatter
	},
	data: [{
		type: "bar",
		showInLegend: true,
		name: "Gold",
		color: "teal",
		dataPoints:plan_plot_count
	}]
});


chart3.render();
chart4.render();
function toolTipFormatter(e) {
	var str = "";
	var total = 0 ;
	var str3;
	var str2 ;
	for (var i = 0; i < e.entries.length; i++){
		var str1 = "<span style= \"color:"+e.entries[i].dataSeries.color + "\">" + e.entries[i].dataSeries.name + "</span>: <strong>"+  e.entries[i].dataPoint.y + "</strong> <br/>" ;
		total = e.entries[i].dataPoint.y + total;
		str = str.concat(str1);
	}
	str2 = "<strong>" + e.entries[0].dataPoint.label + "</strong> <br/>";
	str3 = "<span style = \"color:Tomato\">Total: </span><strong>" + total + "</strong><br/>";
	return (str2.concat(str)).concat(str3);
}

function toggleDataSeries(e) {
	if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
		e.dataSeries.visible = false;
	}
	else {
		e.dataSeries.visible = true;
	}
	chart.render();
}

chart.render();
chart2.render();


}

   

</script>
  
</body>
</html>